(()=>{fetchHandleError=t=>{if(t.ok)return t;throw Error(t.statusText)},fetchJson=t=>t.json(),fetchWrapper=(t,e,n,s)=>(e.headers=e.headers||{},e.headers["X-Requested-With"]="XMLHttpRequest",fetch(t,e).then(fetchHandleError).then(fetchJson).then(n).catch(s||console.error)),stringToColor=t=>{for(var e=0,n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);var s="#";for(n=0;n<3;n++)s+=("00"+(e>>8*n&255).toString(16)).substr(-2);return s},convertLimit=e=>(e.includes("?")||(e+="?"),t.get("limit")&&(e=e.replace("stats/","stats/all/")),e);const t=new URLSearchParams(window.location.search);window.charts=[],document.addEventListener("DOMContentLoaded",(()=>{$('a[data-toggle="tab"][data-type="pie"]').on("show.bs.tab",(function(){$(this).unbind("show.bs.tab");const t=document.getElementById(this.getAttribute("aria-controls"));return t.innerHTML='<div class="spinner text-center"><i class="fa fa-spinner fa-pulse" aria-hidden="true"></i><i> Loading.</i></div>'+t.innerHTML,e=this.dataset.url,n=this.dataset.canvas,s=this.dataset.label,a=this.dataset.title,e=convertLimit(e),void fetchWrapper(e,{},(function(t){let e=[],o=[],i=[];for(const[n,s]of Object.entries(t))e.push(n),o.push(s),i.push(stringToColor(n));const r=!(e.length>10),c=n&&n.nodeType===Node.ELEMENT_NODE?n:document.getElementById(n).getContext("2d");window.charts[c.canvas.id]=new Chart(c,{type:"pie",data:{labels:e,datasets:[{data:o,backgroundColor:i,label:s}]},options:{legend:{display:r,position:"bottom"},title:{display:!0,text:a}}}),$(".spinner").remove()}));var e,n,s,a})),$("#nav-stats-tab").on("show.bs.tab",(function(){$(this).unbind("show.bs.tab");const t=document.getElementById(this.getAttribute("aria-controls"));t.innerHTML='<div class="spinner text-center"><i class="fa fa-spinner fa-pulse" aria-hidden="true"></i><i> Loading.</i></div>'+t.innerHTML;let e=this.dataset.url;const n=this.dataset.canvas;e=convertLimit(e),fetchWrapper(e,{},(function(t){const e=[],s=["num_users","num_productions","num_tours","num_performances","num_performers","num_characters","num_castmembers","num_masters","num_recordings"];let a={};for(const t of s)a[t]=[];let o=[];for(const n of t){e.push(n.created_at);for(const t of s)a[t].push(n[t])}for(const[t,e]of Object.entries(a))o.push({label:t.replace("num_",""),data:e,borderColor:stringToColor(t)});const i=n&&n.nodeType===Node.ELEMENT_NODE?n:document.getElementById(n).getContext("2d"),r=i.canvas.id;window.charts[r]=new Chart(i,{type:"line",data:{labels:e,datasets:o},options:{scales:{xAxes:[{type:"time",time:{},scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{type:"logarithmic",scaleLabel:{}}]}}});const c=$('input[name="stats-logarithmic-toggle"]');c.click((t=>{const e=c.prop("checked"),n=window.charts[r];n.config.options.scales.yAxes[0].type=e?"logarithmic":"linear",n.update()})),$(".spinner").remove()}))})),$("#nav-records-tab,#nav-multiple-tab").on("show.bs.tab",(function(){$(this).unbind("show.bs.tab");const t=document.getElementById(this.getAttribute("aria-controls"));t.innerHTML='<div class="spinner text-center"><i class="fa fa-spinner fa-pulse" aria-hidden="true"></i><i> Loading.</i></div>'+t.innerHTML;const e=this.dataset.url;fetch(e,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then((t=>t.text())).then((e=>{t.innerHTML=e})).then((()=>{const e=$(t);0===e.find('[data-toggle="tippy"]').length&&addCastButtons(e.find("a"))}))}));const t=window.location.hash;if(t)return $(`div.nav a[href="${t}"]`).tab("show");$("#nav-tab a:first-child").tab("show")}))})();